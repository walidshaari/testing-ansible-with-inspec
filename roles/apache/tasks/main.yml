# Copyright (c) 2017, Hasan Turken turkenh@gmail.com
#
# All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:
#
# Redistributions of source code must retain the above copyright notice, this
# list of conditions and the following disclaimer. Redistributions in binary
# form must reproduce the above copyright notice, this list of conditions and
# the following disclaimer in the documentation and/or other materials provided
# with the distribution. THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND
# CONTRIBUTORS ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT
# NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
# PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR
# CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
# EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
# PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
# IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
# POSSIBILITY OF SUCH DAMAGE.


- name: Add repository
  yum_repository:
    name: wandisco
    description: Wandisco YUM repo
    baseurl: http://opensource.wandisco.com/rhel/$releasever/git/$basearch
    gpgcheck: no

- name: Installs necessary packages
  package: pkg={{ item }} state=latest
  with_items:
    - httpd
    - git
    - curl

- name: Push future default virtual host configuration
  copy: src=cfgmgmtcamp dest=/etc/httpd/conf.d/cfgmgmtcamp.conf mode=0640

- name: Deploy the configuration management camp website
  git: repo=https://github.com/cfgmgmtcamp/cfgmgmtcamp.github.io.git dest=/var/www/cfgmgmtcamp depth=1
  tags: deploy
  notify:
    - restart apache
#- name: Activates the virtualhost
#  command: a2ensite cfgmgmtcamp

- name: Check that the config is valid
  command: apachectl configtest
  register: result
  ignore_errors: True

- name: ensure httpd is enabled and runing
  service: 
    name: httpd 
    state: started 
    enabled: yes
